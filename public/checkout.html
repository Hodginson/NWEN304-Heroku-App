<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>CheckOut</title>
    <link rel="stylesheet" href="stylesheets/store.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link href="css/jquery-ui.min.css" rel="stylesheet">
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
</head>
<!--Temporary CSS-->
<style>
    .itemImage {
        width: 5em;
    }

    .filterDiv :hover {
        background-color: yellow;
    }

    #check-out-btn {
        background-color: chocolate;
    }

    .filterDiv {
        float: left;
        background-color: rgb(247, 184, 10);
        color: #1b0202;
        width: 100%;
        line-height: 100px;
        text-align: center;
        margin: 8px;
        margin-left: 2px;
        display: none;
    }

    .show {
        display: block;
    }

    .div_show {
        display: block;
    }

    .div_hide {
        display: none;
    }

    .container {
        margin-top: 20px;
        overflow: hidden;
    }

    /* Style the buttons */
    .btn {
        border: none;
        outline: none;
        padding: 12px 16px;
        background-color: #f1f1f1;
        cursor: pointer;
    }

    .btn:hover {
        background-color: #ddd;
    }

    .btn.active {
        background-color: #666;
        color: white;
    }

    .goleft {
        float: left;
        width: 20%;

    }

    .goright {
        float: right;
        width: 80%;
        color: #333333;
        font-size: 16px;
        font-weight: bold;
        text-align: left;
        margin-bottom: 30px;
    }

    div.buyPageDiv {
        margin: 20px auto;
        max-width: 1013px;
    }

    div.address {
        margin: 20px 5px;
        text-align: left;
    }

    div.addressTip,
    div.productListTip {
        color: #333333;
        font-size: 16px;
        font-weight: bold;
        text-align: left;
        margin-bottom: 30px;
    }

    table.addressTable {
        margin: 20px 20px;
        width: 600px;
        font-size: 12px;
    }

    table.addressTable td {
        color: #333333;
        text-align: right;
        vertical-align: top;
        padding-right: 5px;
        text-align: left;
        height: 30px;
    }

    table.addressTable td.firstColumn {
        width: 100px;
    }

    table.addressTable td textarea {
        border: 1px solid #AFAFAF;
        margin-bottom: 10px;
        width: 400px;
    }

    table.addressTable td input {
        border: 1px solid #AFAFAF;
        width: 200px;
    }

    span.redStar {
        color: red;
        font-size: 8px;
    }

    .r {
        position: fixed;
        bottom: 0;
    }

    .l {
        position: fixed;
        right: 0;
        bottom: 0;
    }

    .t {
        position: fixed;
        right: 0;
        top: 0;
    }
</style>

<body onload="Load()">
    <!--Main NavBar starts-->

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#" id="user_info">{USER INFO}</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="store.html">Product <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        Contact us
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">022-XXX-XXXX</a>
                        <a class="dropdown-item" href="#">banana@gmail.com</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">#Instagram</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
                        aria-expanded="false">
                        Account
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="users/login">Log in</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Need Help?</a>
                    </div>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                <button class="btn btn-outline-sjuccess my-2 my-sm-0" type="submit" Log out id="logout_btn" href="users/logout">Log
                    Out
                </button>
            </form>
        </div>
    </nav>
    <!--Main NavBar ends-->
    <!--Address starts-->

    <div class="buyPageDiv">
        <div class="checktitle">
            <div><a href="store.html"><img src="images/Banana-Cartoon.png" width="120px" height="90px" /></a></div>
        </div>
        <div class="address">
            <div class="addressTip">Entry Address</div>
            <div>
                <table class="addressTable">
                    <tbody>
                        <tr>
                            <td class="firstColumn">Address Detail<span class="redStar">*</span></td>
                            <td><textarea placeholder="It is recommended that you fill in the detailed delivery address, such as the name, the house number, the floor and the room number"
                                    name="address"></textarea></td>
                        </tr>
                        <tr>
                            <td>Post Code</td>
                            <td><input type="text" placeholder="Defult code number 000000" name="post"></td>
                        </tr>
                        <tr>
                            <td>User name</td>
                            <td><input type="text" placeholder="No More than 25 Characters" name="receiver"></td>
                        </tr>
                        <tr>
                            <td>Phone number <span class="redStar">*</span></td>
                            <td><input type="text" placeholder="Entry your phone number" name="mobile"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!--delivery methods-->
        <div class="dilivery">
            <div class="addressTip">Choose Delivery Type</div>
            <div> <input type="radio" name="deltype" id="de1" ,value=15 /> Fast Post: Reachable in three to four days,$15Fees
                <br />
                <input type="radio" name="deltype" id="de2" ,value=0 /> Ordinary Post: Reachable in seven to ten days,$0Fees
                <br />
            </div>
        </div>
        <!--payment methods-->
        <div class="payment">
            <div class="addressTip">Choose payment Type</div>
            <button id="button1">Creadt Card</button>
            <div id="div1">
                <table class="addressTable">
                    <tbody>
                        <tr>
                            <td>Card number <span class="redStar">*</span></td>
                            <td><input type="text" placeholder="Entry your Card number" name="card"></td>
                        </tr>
                        <tr>
                            <td>Private Code<span class="redStar">*</span></td>
                            <td><input type="text" placeholder="Defult code number 000" name="code"></td>
                        </tr>
                        <tr>
                            <td>Date<span class="redStar">*</span></td>
                            <td><input type="text" placeholder="00/00" name="data"></td>
                        </tr>
                        <tr>
                            <td>User name<span class="redStar">*</span></td>
                            <td><input type="text" placeholder="No More than 25 Characters" name="receiver"></td>
                        </tr>

                    </tbody>
                </table>
            </div>
            <button id="button2">Paypel</button>
            <div id="div2">
                <table class="addressTable">
                    <tbody>
                        <tr>
                            <td>Paypal Bank <span class="redStar">*</span></td>
                            <td><select>
                                    <option value="volvo">ANZ</option>
                                    <option value="saab">BNZ</option>
                                    <option value="opel">KiwiBank</option>
                                </select></td>
                        </tr>
                        <tr>
                            <td>Card Number <span class="redStar">*</span></td>
                            <td><input type="text" placeholder="Entry your Card number" name="card"></td>
                        </tr>
                        <tr>
                            <td>Private Code<span class="redStar">*</span></td>
                            <td><input type="text" placeholder="Defult code number 000" name="code"></td>
                        </tr>
                        <tr>
                            <td>User name<span class="redStar">*</span></td>
                            <td><input type="text" placeholder="No More than 25 Characters" name="receiver"></td>
                        </tr>

                    </tbody>
                </table>
            </div>

        </div>
        <!--sidepart-->
        <div>
            <div class="t">
                <table class="productTable">
                    <tbody>
                        <tr>
                            <td>Product Amount: </td>
                            <td id="td1"></td>
                        </tr>
                        <tr>
                            <td>Delivery Fee: </td>
                            <td id="td2"></td>
                        </tr>
                        <tr>
                            <td>Total: </td>

                            <td id="td3"></td>
                        </tr>
                    </tbody>
                </table>
                
            </div>
            <!--back to cart botton-->
            <div>
                <div class="r">
                    <a href="cart.html"><input type="submit" value="Go Back to Cart" class="btn btn-primary" /></a>
                </div>
            </div>
            <!--success to check out-->
            <div>
                <div class="l">
                    <button id="check-out-btn"><a href="check.html" ><input type="submit" value="Check Out"></a></button>
                </div>
            </div>
        </div>
        <script>
            var cartTable;
            var itemTable;
            var timedate = fun();
            console.log(timedate);
            df1 = 0;
            df2 = 0;
            $(function () {

                var df11 = df1;
                $("#td1").text('$ ' + df11);

            });
            $(function () {

                var df21 = df2;
                $("#td2").text('$ ' + df21);

            });
            $(function () {

                var df3 = df1 + df2;
                Total=df3;
                $("#td3").text('$ ' + df3);

            });

            $('input[type=radio][name=deltype]').change(function () {
                if (this.id == 'de1') {
                    df2 = 15;
                }
                else if (this.id == 'de2') {
                    df2 = 0;
                }
                var df21 = df2;
                $("#td2").text('$ ' + df21);

                var df3 = df1 + df2;
                $("#td3").text('$ ' + df3);
            });
        
          function fun(){
            var date =new Date();
            var y = date.getFullYear();
            var m = date.getMonth();
            var d = date.getDate();
            timedate = y+"-"+m+"-"+d;
            return timedate;
           }
           
           
                      
            function Load() {
                
                var Total= getItems().df3;

                var username= '';
                $.ajax({
                    url: "/api/logged",
                    method: "GET"
                }).done(function (msg) {
                    username=msg;
                    console.log(username+" total: "+ Total);
                    console.log('login status: ' + msg);
                    if (msg != '0') {
                        // Find method to get the users first and last name (or email address)
                        document.getElementById("user_info").innerHTML = msg;
                    }
                }).fail(function (data, status) {
                    alert(status);
                });


                $('#check-out-btn').click(function(){
                    $.ajax({
                    url: "/api/clear",
                    method: "DELETE"
                }).done(function (msg) {
                    console.log(msg);
                }).fail(function (data, status) {
                    alert(status);
                });
                });
            }

            $(document).ready(function () {
                $('submitbin').click(function () {
                    alert($('input:radio[name=deltype]:checked').val());
                });

                

            });

            function getItems() {
                // item table
                $.ajax({
                    url: "/api/items",
                    method: "GET"
                }).done(function (msg) {
                    console.log(msg);
                    itemTable = msg;
                    getCart();
                }).fail(function (data, status) {
                    alert(status);
                });
            }

            function getCart() {
                // cart table
                $.ajax({
                    url: "/api/products",
                    method: "GET"
                }).done(function (msg) {
                    console.log(msg);
                    cartTable = msg;
                    calculateCartTotal();
                }).fail(function (data, status) {
                    alert(status);
                });
            }



            function calculateCartTotal() {
                var total = 0;
                if (cartTable.length > 0) {
                    for (var i = 0; i < cartTable.length; i++) {
                        var currentItem = itemTable[cartTable[i].item_id - 1];
                        total += currentItem.item_price * cartTable[i].item_quantity;
                    }
                }
                df1 = total;
                $("#td1").text('$ ' + df1);
                var df3 = df1 + df2;
                $("#td3").text('$ ' + df3);

                return df3;
            }

            $(function () {
                $('#div1').toggle();
                $('#div2').toggle();

                $('#button1').on('click', function () {
                    $('#div1').toggle();
                });

                $('#button2').on('click', function () {
                    $('#div2').toggle();
                });

            });

        </script>
</body>

</html>